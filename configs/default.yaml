project:
  name: btcusdt-regime-multistrategy-trading
  contract_version: "1.0.0"

data:
  symbol: BTCUSDT
  venue: binance_spot
  timezone: UTC
  source_frequency: "1m"
  derived_frequencies: ["15m", "1h"]

  paths:
    raw_1m: data/raw_1m
    clean_1m: data/clean_1m
    bars_15m: data/bars_15m
    bars_1h: data/bars_1h
    reports: data/reports
    signals: results/signals
    backtest: results/backtest
    metrics: results/metrics

  storage:
    format: parquet
    compression: snappy
    naming_mode: monthly_file

  timestamp:
    field: timestamp
    convention: bar_close_time
    interval_semantics: "(t-delta, t]"
    timezone: UTC

qc:
  require_unique_timestamp: true
  require_monotonic_timestamp: true
  enforce_positive_prices: true
  enforce_non_negative_volume: true
  fill_missing_1m: true
  fill_rule:
    open: previous_close
    high: previous_close
    low: previous_close
    close: previous_close
    volume: 0.0
    is_synthetic: 1

aggregation:
  resample_closed: right
  resample_label: right
  ohlcv:
    open: first
    high: max
    low: min
    close: last
    volume: sum

alignment:
  regime_frame: "1h"
  strategy_frame: "15m"
  mapping_1h_to_15m: forward_fill_last_completed_1h_regime
  anti_lookahead: true

regime:
  labels:
    R1: "Trend + LowVol"
    R2: "Trend + HighVol"
    R3: "Range + LowVol"
    R4: "Range + HighVol"

  trend:
    ema_fast: 24
    ema_slow: 96
    adx_window: 14
    adx_threshold: 20.0
    ema_gap_threshold: 0.0

  volatility:
    atr_window: 14
    quantile_lookback: 720
    high_vol_quantile: 0.75

  smoothing:
    min_regime_run_bars: 3

  output:
    dir_1h: results/regime
    dir_15m: results/regime
    dir_plots: results/regime/plots
    default_regime_15m: R4

allocator:
  strategy_weights:
    R1:
      donchian: 0.6
      ema_adx: 0.4
      mean_reversion: 0.0
    R2:
      donchian: 0.4
      ema_adx: 0.4
      mean_reversion: 0.0
    R3:
      donchian: 0.0
      ema_adx: 0.0
      mean_reversion: 1.0
    R4:
      donchian: 0.0
      ema_adx: 0.0
      mean_reversion: 0.0


signals:
  output:
    dir_15m: results/signals

  execution:
    long_only: true
    min_hold_bars: 168
    rebalance_threshold: 0.2

  donchian:
    window: 20
    hold_until_opposite: true

  ema_adx:
    ema_fast: 21
    ema_slow: 55
    adx_window: 14
    adx_threshold: 20.0
    use_adx_filter: true

  mean_reversion:
    z_window: 48
    entry_z: 1.5
    exit_z: 0.5


backtest:
  output:
    dir_backtest: results/backtest
    dir_metrics: results/metrics

  execution:
    initial_equity: 100000.0
    fee_bps: 4.0
    slippage_bps: 1.0
    long_only: true

  assumptions:
    position_lag_bars: 1
    bars_per_year_15m: 35040

  stress_test:
    output_dir: results/metrics
    fee_bps_values: [4.0, 8.0, 12.0]
    slippage_bps_values: [1.0, 2.0, 4.0]
    position_lag_bars_values: [1, 2, 3]
    volatility_multipliers: [1.0, 1.5, 2.0]
    include_combined_worst_case: true

  walk_forward:
    selection_metric: sharpe
    output_dir: results/metrics
    folds:
      - name: wf_train_2022_valid_2023_test_2024
        train_start: "2022-01-01T00:00:00Z"
        train_end: "2022-12-31T23:59:59Z"
        valid_start: "2023-01-01T00:00:00Z"
        valid_end: "2023-12-31T23:59:59Z"
        test_start: "2024-01-01T00:00:00Z"
        test_end: "2024-12-31T23:59:59Z"
      - name: wf_train_2022_2023_valid_2024_test_2025
        train_start: "2022-01-01T00:00:00Z"
        train_end: "2023-12-31T23:59:59Z"
        valid_start: "2024-01-01T00:00:00Z"
        valid_end: "2024-12-31T23:59:59Z"
        test_start: "2025-01-01T00:00:00Z"
        test_end: "2025-12-31T23:59:59Z"
    candidates:
      current: {}
      r1_55_45:
        R1:
          donchian: 0.55
          ema_adx: 0.45
          mean_reversion: 0.0
      r2_50_30:
        R2:
          donchian: 0.50
          ema_adx: 0.30
          mean_reversion: 0.0
      r2_30_50:
        R2:
          donchian: 0.30
          ema_adx: 0.50
          mean_reversion: 0.0
      r3_80pct:
        R3:
          donchian: 0.0
          ema_adx: 0.0
          mean_reversion: 0.8

